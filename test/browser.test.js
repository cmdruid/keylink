!function(n,e){"use strict";const t="qpzry9x8gf2tvdw0s3jn54khce6mua7l",r=[996825010,642813549,513874426,1027748829,705979059],i="bech32",o="bech32m";function s(n){switch(n){case i:return 1;case o:return 734539939;default:throw new Error(`Unrecognized encoding: ${n}`)}}function a(n){let e=1;for(let t=0;t<n.length;++t){const i=e>>25;e=(33554431&e)<<5^n[t];for(let n=0;n<5;++n)(i>>n&1)>0&&(e^=r[n])}return e}function c(n){const e=[];let t;for(t=0;t<n.length;++t)e.push(n.charCodeAt(t)>>5);for(e.push(0),t=0;t<n.length;++t)e.push(31&n.charCodeAt(t));return e}function u(n,e,t,r=!0){const i=[];let o=0,s=0;const a=(1<<t)-1,c=(1<<e+t-1)-1;for(const r of n){if(r<0||r>>e>0)return[];for(o=(o<<e|r)&c,s+=e;s>=t;)s-=t,i.push(o>>s&a)}if(r)s>0&&i.push(o<<t-s&a);else if(s>=e||(o<<t-s&a)>0)return[];return i}function f(n,e,r){const i=e.concat(function(n,e,t){const r=a(c(n).concat(e).concat([0,0,0,0,0,0]))^s(t),i=[];for(let n=0;n<6;++n)i.push(r>>5*(5-n)&31);return i}(n,e,r));let o=n+"1";for(let n=0;n<i.length;++n)o+=t.charAt(i[n]);return o}function l(n,e){const r=e>0?"bech32m":"bech32";if(!function(n){let e,t,r=!1,i=!1;for(e=0;e<n.length;++e){if(t=n.charCodeAt(e),t<33||t>126)return!1;t>=97&&t<=122&&(r=!0),t>=65&&t<=90&&(i=!0)}return!(r&&i)}(n))return{hrp:null,data:[255]};if(!function(n){const e=n.lastIndexOf("1");return!(e<1||e+7>n.length||n.length>90)}(n=n.toLowerCase()))return{hrp:null,data:[255]};const i=[],o=n.lastIndexOf("1"),u=n.substring(0,o);for(let e=o+1;e<n.length;++e){const r=t.indexOf(n.charAt(e));if(-1===r)return{hrp:null,data:[255]};i.push(r)}return function(n,e,t){return a(c(n).concat(e))===s(t)}(u,i,r)?{hrp:u,data:i.slice(0,i.length-6)}:{hrp:null,data:[255]}}function h(n,e=0){const t=n.split("1",1)[0],{hrp:r,data:i}=l(n,e),o=u(i.slice(1),5,8,!1),s=o.length;switch(!0){case t!==r:throw new Error("Returned hrp string is invalid.");case null===o||s<2||s>40:throw new Error("Decoded string is invalid or out of spec.");case i[0]>16:throw new Error("Returned version bit is out of range.");case 0===i[0]&&20!==s&&32!==s:throw new Error("Decoded string does not match version 0 spec.");case 0===i[0]&&0!==e:case 0!==i[0]&&1!==e:throw new Error("Decoded version bit does not match.");default:return Uint8Array.from(o)}}var d={encode:function(n,e="bch",t=0){const r=f(e,[t,...u([...n],8,5)],t>0?"bech32m":"bech32");return h(r,t),r},decode:h};const y=[{name:"base58",charset:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"},{name:"base64",charset:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"},{name:"base64url",charset:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}];function p(n){for(const e of y)if(e.name===n)return e.charset;throw TypeError("Charset does not exist: "+n)}var w={encode:function(n,e,t=!1){const r=p(e),i=r.length,o=[];let s,a,c,u="",f=0;for(s=0;s<n.length;s++)for(f=0,a=n[s],u+=a>0||(u.length^s)>0?"":"1";f in o||a>0;)c=o[f],c=c>0?256*c+a:a,a=c/i|0,o[f]=c%i,f++;for(;f-- >0;)u+=r[o[f]];return t&&u.length%4>0?u+"=".repeat(4-u.length%4):u},decode:function(n,e){const t=p(e),r=t.length,i=[],o=[];n=n.replace("=","");let s,a,c,u=0;for(s=0;s<n.length;s++){if(u=0,a=t.indexOf(n[s]),a<0)throw new Error(`Character range out of bounds: ${a}`);for(s=a>0||(o.length^s)>0?s:o.push(0);u in i||a>0;)c=i[u],c=c>0?c*r+a:a,a=c>>8,i[u]=c%256,u++}for(;u-- >0;)o.push(i[u]);return Uint8Array.from(o)}};class v extends Uint8Array{constructor(n,e){if(void 0!==e){const t=new Uint8Array(e).fill(0);t.set(new Uint8Array(n)),n=t.buffer}return super(n),this}toArr(){return Array.from(this)}toStr(){return g(this)}toNum(){return function(n){let e,t=0;for(e=n.length-1;e>=0;e--)t=256*t+n[e];return Number(t)}(this)}toBig(){return function(n){let e,t=0n;for(e=n.length-1;e>=0;e--)t=256n*t+BigInt(n[e]);return BigInt(t)}(this)}toHex(){return function(n){const e=[];let t;for(t=0;t<n.length;t++)e.push(n[t].toString(16).padStart(2,"0"));return e.join("")}(this)}toJson(){return JSON.parse(g(this))}toBytes(){return new Uint8Array(this)}toBech32(n,e){return d.encode(this,n,e)}toBase58(){return w.encode(this,"base58")}toBase64(n){return w.encode(this,"base64",n)}toB64url(){return w.encode(this,"base64url")}prepend(n){return v.of(...n,...this)}append(n){return v.of(...this,...n)}slice(n,e){const t=new Uint8Array(this.buffer).slice(n,e);return new v(t.buffer)}write(n,e){this.set(n,e)}varint(n){return v.of(...this,...v.varint(n))}static from(n){return new v(Uint8Array.from(n).buffer)}static of(...n){return new v(Uint8Array.of(...n).buffer)}static join(n){let e,t=0;const r=n.reduce(((n,e)=>n+e.length),0),i=new Uint8Array(r);for(const r of n)for(e=0;e<r.length;t++,e++)i[t]=r[e];return new v(i,r)}static varint(n){if(n<253)return v.num(n,1);if(n<65536)return v.of(253,...v.num(n,2));if(n<4294967296)return v.of(254,...v.num(n,4));if(n<0x10000000000000000)return v.of(255,...v.num(n,8));throw new Error(`Value is too large: ${n}`)}}function b(n){return(new TextEncoder).encode(n).buffer}function g(n){return(new TextDecoder).decode(n)}v.str=(n,e)=>new v(b(n),e),v.hex=(n,e)=>new v(function(n){const e=[];let t,r=0;if(n.length%2>0)throw new Error(`Invalid hex string length: ${n.length}`);for(t=0;t<n.length;t+=2)e[r]=parseInt(n.slice(t,t+2),16),r+=1;return Uint8Array.from(e).buffer}(n),e),v.num=(n,e)=>new v(function(n){const e=[];for(;n>0;){const t=255&n;e.push(t),n=(n-t)/256}return Uint8Array.from(e).buffer}(n),e),v.big=(n,e)=>new v(function(n){const e=[];for(;n>0n;){const t=0xffn&n;e.push(Number(t)),n=(n-t)/256n}return Uint8Array.from(e).buffer}(n),e),v.buff=(n,e)=>new v(n,e),v.json=n=>new v(b(JSON.stringify(n))),v.bech32=(n,e)=>new v(d.decode(n,e)),v.base58=n=>new v(w.decode(n,"base58")),v.base64=n=>new v(w.decode(n,"base64")),v.b64url=n=>new v(w.decode(n,"base64url"));class m{constructor(n){this.data=new Uint8Array(n),this.size=this.data.length}peek(n){if(n>this.size)throw new Error(`Size greater than stream: ${n} > ${this.size}`);return new v(this.data.slice(0,n).buffer)}read(n){n=n??this.varint();const e=this.peek(n);return this.data=this.data.slice(n),this.size=this.data.length,e}varint(){const n=this.read(1).toNum();switch(!0){case n>=0&&n<253:return n;case 253===n:return this.read(2).toNum();case 254===n:return this.read(4).toNum();case 255===n:return this.read(8).toNum();default:throw new Error(`Varint is out of range: ${n}`)}}}const x={[(0).toString()]:"Expected Private",[1..toString()]:"Expected Point",[2..toString()]:"Expected Tweak",[3..toString()]:"Expected Hash",[4..toString()]:"Expected Signature",[5..toString()]:"Expected Extra Data (32 bytes)",[6..toString()]:"Expected Parity (1 | 0)",[7..toString()]:"Bad Recovery Id"};function A(n){const e=x[n.toString()]||`Unknow error code: ${n}`;throw new TypeError(e)}const E=new Uint8Array(32),U=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,186,174,220,230,175,72,160,59,191,210,94,140,208,54,65,65]);function P(n){return n instanceof Uint8Array}function T(n,e){for(let t=0;t<32;++t)if(n[t]!==e[t])return n[t]<e[t]?-1:1;return 0}function S(n){return P(n)&&32===n.length&&T(n,E)>0&&T(n,U)<0}function k(n){S(n)||A(0)}function K(n){(function(n){return P(n)&&(33===n.length||65===n.length||32===n.length)})(n)||A(1)}function M(n){(function(n){return P(n)&&32===n.length})(n)||A(1)}function z(n){(function(n){return P(n)&&32===n.length&&T(n,U)<0})(n)||A(2)}function L(n){(function(n){return P(n)&&32===n.length})(n)||A(3)}function _(n){(function(n){return void 0===n||P(n)&&32===n.length})(n)||A(5)}function B(n){(function(n){return P(n)&&64===n.length&&T(n.subarray(0,32),U)<0&&T(n.subarray(32,64),U)<0})(n)||A(4)}var N=Object.freeze({__proto__:null,default:function(n){return function(n,e,t,r){function i(n,e,t){var r=t?WebAssembly.instantiateStreaming:WebAssembly.instantiate,i=t?WebAssembly.compileStreaming:WebAssembly.compile;return e?r(n,e):i(n)}var o=null,s="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node;if(e&&s){var a=require("fs"),c=require("path");return new Promise(((n,t)=>{a.readFile(c.resolve(__dirname,e),((e,o)=>{null!=e&&t(e),n(i(o,r,!1))}))}))}if(e)return i(fetch(e),r,!0);if(s)o=Buffer.from(t,"base64");else{var u=globalThis.atob(t),f=u.length;o=new Uint8Array(new ArrayBuffer(f));for(var l=0;l<f;l++)o[l]=u.charCodeAt(l)}if(n){var h=new WebAssembly.Module(o);return r?new WebAssembly.Instance(h,r):h}return i(o,r,!1)}(0,"ff8281948b1cc947.wasm",null,n)}});const H=new Uint8Array(N.memory.buffer),q=N.PRIVATE_INPUT.value,Z=N.PUBLIC_KEY_INPUT.value,I=N.PUBLIC_KEY_INPUT2.value,X=N.X_ONLY_PUBLIC_KEY_INPUT.value,C=N.X_ONLY_PUBLIC_KEY_INPUT2.value,R=N.TWEAK_INPUT.value,Y=N.HASH_INPUT.value,D=N.EXTRA_DATA_INPUT.value,G=N.SIGNATURE_INPUT.value,Q=H.subarray(q,q+32),W=H.subarray(Z,Z+65);H.subarray(I,I+65);const F=H.subarray(X,X+32);H.subarray(C,C+32);const j=H.subarray(R,R+32),J=H.subarray(Y,Y+32),V=H.subarray(D,D+32),$=H.subarray(G,G+64);function O(n,e){return void 0===n?void 0!==e?e.length:33:n?33:65}function nn(n){return function(n){return P(n)&&(33===n.length||65===n.length)}(n)&&function(n){try{return W.set(n),1===N.isPoint(n.length)}finally{W.fill(0)}}(n)}function en(n){return S(n)}function tn(n,e,t){L(n),k(e),_(t);try{return J.set(n),Q.set(e),void 0!==t&&V.set(t),$.slice(0,64)}finally{J.fill(0),Q.fill(0),void 0!==t&&V.fill(0),$.fill(0)}}function rn(n,e,t){L(n),k(e),_(t);try{return J.set(n),Q.set(e),void 0!==t&&V.set(t),$.slice(0,64)}finally{J.fill(0),Q.fill(0),void 0!==t&&V.fill(0),$.fill(0)}}function on(n,e,t){L(n),M(e),B(t);try{return J.set(n),F.set(e),$.set(t),1===N.verifySchnorr()}finally{J.fill(0),F.fill(0),$.fill(0)}}function sn(n,e){if(n!==e)throw new TypeError("Master key refcode must be default.");return!0}const an=[{name:"bitcoin",seed:"Bitcoin seed",prefix:{public:76067358,private:76066276,export:128,address:"bc"},index:{signMask:2147483648,maxIndex:Math.pow(2,31)-1},map:{hardPrefix:128,softPrefix:0},defaults:{index:0,depth:0,refcode:0}}];function cn(n){const e=Object.values(an).find((({name:e})=>e===n));if(void 0===e)throw TypeError("Key configuration does not exist for type: "+n);return e}async function un(n,t="SHA-256"){return e.webcrypto.subtle.importKey("raw",n,{name:"HMAC",hash:t},!1,["sign","verify"])}function fn(n){let e=0n;for(let t=n.length-1;t>=0;t--)e=256n*e+BigInt(n[t]);return BigInt(e)}function ln(n,e=0){const t=[];for(;n>0;){const e=0xffn&n;t.push(e),n=(n-e)/256n}let r=Uint8Array.from(t.map((n=>Number(n))));if(0!==e){const n=new Uint8Array(e);n.set(r),r=n}return r}const hn=[0n,1n,2n,3n,4n,5n,6n,7n,8n,9n,10n,11n,12n,13n,14n,15n,7n,4n,13n,1n,10n,6n,15n,3n,12n,0n,9n,5n,2n,14n,11n,8n,3n,10n,14n,4n,9n,15n,8n,1n,2n,7n,0n,6n,13n,11n,5n,12n,1n,9n,11n,10n,0n,8n,12n,4n,13n,3n,7n,15n,14n,5n,6n,2n,4n,0n,5n,9n,7n,12n,2n,10n,14n,1n,3n,8n,11n,6n,15n,13n],dn=[5n,14n,7n,0n,9n,2n,11n,4n,13n,6n,15n,8n,1n,10n,3n,12n,6n,11n,3n,7n,0n,13n,5n,10n,14n,15n,8n,12n,4n,9n,1n,2n,15n,5n,1n,3n,7n,14n,6n,9n,11n,8n,12n,2n,10n,0n,4n,13n,8n,6n,4n,1n,3n,11n,15n,0n,5n,12n,2n,13n,9n,7n,10n,14n,12n,15n,10n,4n,1n,5n,8n,7n,6n,2n,13n,14n,0n,3n,9n,11n],yn=[11n,14n,15n,12n,5n,8n,7n,9n,11n,13n,14n,15n,6n,7n,9n,8n,7n,6n,8n,13n,11n,9n,7n,15n,7n,12n,15n,9n,11n,7n,13n,12n,11n,13n,6n,7n,14n,9n,13n,15n,14n,8n,13n,6n,5n,12n,7n,5n,11n,12n,14n,15n,14n,15n,9n,8n,9n,14n,5n,6n,8n,6n,5n,12n,9n,15n,5n,11n,6n,8n,13n,12n,5n,12n,13n,14n,11n,8n,5n,6n],pn=[8n,9n,9n,11n,13n,15n,15n,5n,7n,7n,8n,11n,14n,14n,12n,6n,9n,13n,15n,7n,12n,8n,9n,11n,7n,7n,12n,7n,6n,15n,13n,11n,9n,7n,15n,11n,8n,6n,6n,14n,12n,13n,5n,14n,13n,13n,7n,5n,15n,5n,8n,11n,14n,14n,6n,14n,6n,9n,12n,9n,12n,5n,15n,8n,8n,5n,12n,9n,12n,5n,14n,6n,8n,13n,6n,5n,15n,13n,11n,11n],wn=[0n,0x5a827999n,0x6ed9eba1n,0x8f1bbcdcn,0xa953fd4en],vn=[0x50a28be6n,0x5c4dd124n,0x6d703ef3n,0x7a6d76e9n,0n];function bn(n,e,t,r){switch(!0){case 0n===r:return n^e^t;case 1n===r:return n&e|~n&t;case 2n===r:return(n|~e)^t;case 3n===r:return n&t|e&~t;case 4n===r:return n^(e|~t);default:throw new TypeError("Unknown I value: "+String(r))}}function gn(n,e){return 0xffffffffn&(n<<e|(0xffffffffn&n)>>32n-e)}function mn(n,e,t,r,i,o){const s=[];let a,c,u,f,l,h,d,y=n,p=e,w=t,v=r,b=i,g=n,m=e,x=t,A=r,E=i;for(let n=0;n<16;n++){const e=fn(o.slice(4*n,4*(n+1)));s.push(e)}for(let n=0;n<80;n++)a=BigInt(n)>>4n,f=s[Number(hn[n])],l=wn[Number(a)],h=s[Number(dn[n])],d=vn[Number(a)],y=gn(y+bn(p,w,v,a)+f+l,yn[n])+b,c=b,b=v,v=gn(w,10n),w=p,p=y,y=c,g=gn(g+bn(m,x,A,4n-a)+h+d,pn[n])+E,u=E,E=A,A=gn(x,10n),x=m,m=g,g=u;return[e+w+A,t+v+E,r+b+g,i+y+m,n+p+x]}async function xn(n,t="SHA-256",r=1){let i,o=n.buffer;for(i=0;i<r;i++)o=await e.webcrypto.subtle.digest(t,o);return new Uint8Array(o)}async function An(n){return xn(n,"SHA-256")}function En(n){return function(n){let e=[0x67452301n,0xefcdab89n,0x98badcfen,0x10325476n,0xc3d2e1f0n];for(let t=0;t<n.length>>6;t++)e=mn(...e,n.slice(64*t,64*(t+1)));const t=[128,...new Array(119-n.length&63).fill(0)],r=Uint8Array.from([...n.slice(-64&n.length),...t,...ln(BigInt(8*n.length),8)]);for(let n=0;n<r.length>>6;n++)e=mn(...e,r.slice(64*n,64*(n+1)));const i=[];for(let n=0;n<e.length;n++){const t=0xffffffffn&e[n];i.push(...ln(t,4))}return Uint8Array.from(i)}(n)}var Un=Object.freeze({__proto__:null,sha256:An,sha512:async function(n){return xn(n,"SHA-512")},ripe160:En,hash256:async function(n){return xn(n,"SHA-256",2)},hash160:async function(n){return En(await An(n))},hmac256:async function(n,t){const r=await un(n,"SHA-256");return e.webcrypto.subtle.sign("HMAC",r,t).then((n=>new Uint8Array(n)))},hmac512:async function(n,t){const r=await un(n,"SHA-512");return e.webcrypto.subtle.sign("HMAC",r,t).then((n=>new Uint8Array(n)))}});const Pn=Un.hash160,Tn=Un.hash256,Sn=Un.hmac256,kn=Un.hmac512;class Kn{constructor(n,e,t=!1){null===e&&(e=function(n){if(null===n)throw TypeError("Missing private key!");const e=function(n,e){k(n);const t=O(e);try{return Q.set(n),1===N.pointFromScalar(t)?W.slice(0,t):null}finally{Q.fill(0),W.fill(0)}}(n,!0);if(null===e)throw TypeError("Invalid public key!");return e}(n)),this.__privateKey=n,this.__publicKey=e,this.lowR=t}get publicKey(){return this.__publicKey}get privateKey(){return this.__privateKey}signECDSA(n,e){if(null===this.privateKey)throw new Error("Missing private key");if(void 0===e&&(e=this.lowR),e){const e=new Uint8Array(32).fill(0);let t=tn(n,this.privateKey),r=0;for(;t[0]>127;){r+=1;const i=new Uint8Array(6).fill(r);e.set(i,0),t=tn(n,this.privateKey,e)}return t}return tn(n,this.privateKey)}signSchnorr(n){if(null===this.privateKey)throw new Error("Missing private key");return rn(n,this.privateKey)}verifyECDSA(n,e){return null!==this.publicKey&&function(n,e,t,r=!1){L(n),K(e),B(t);try{return J.set(n),W.set(e),$.set(t),1===N.verify(e.length,!0===r?1:0)}finally{J.fill(0),W.fill(0),$.fill(0)}}(n,this.publicKey,e)}verifySchnorr(n,e){return null!==this.publicKey&&on(n,this.publicKey.slice(1,33),e)}}async function Mn(n,e){const t=await kn(n,e),r=t.slice(0,32),i=t.slice(32);return en(r)?[r,i]:Mn(n,zn(e))}function zn(n){let e=n.length;for(e-=1;e>=0;e--)if(n[e]<255)return n.set([n[e]+1],e),n;throw TypeError("Unable to increment buffer: "+n.toString())}const Ln=new TextEncoder;class _n extends Kn{constructor(n,e,t,...r){super(n,e),this.config=cn(r[0]??_n.DEFAULT_TYPE);const{defaults:i}=this.config;this.__chain=t,this.__index=r[1]??v.num(i.index,4),this.__depth=r[2]??i.depth,this.__refcode=r[3]??i.refcode,this.__label=r[4]}get chaincode(){return this.__chain}get rawindex(){return this.__index}get index(){return function(n){switch(!0){case 4===n.length:return v.buff(n.reverse()).toNum();case 1===n[1]:return v.buff(n).toHex();default:return v.buff(n).toStr()}}(this.rawindex)}get depth(){return this.__depth}get refcode(){return this.__refcode}get label(){return this.__label}get isPrivate(){return null!==this.privateKey}async getPubkeyHash(){return Pn(this.publicKey)}async getAddress(){const{prefix:n}=this.config,e=await this.getPubkeyHash();return v.buff(e).toBech32(n.address,0)}async getRef(){const n=(await this.getPubkeyHash()).slice(0,4);return v.buff(n.reverse()).toNum()}exportMeta(){return[this.config.name,this.rawindex,this.depth,this.refcode,this.label]}copy(n=!1){return n||null===this.privateKey?_n.fromPublicLink(this.publicKey,this.chaincode,...this.exportMeta()):_n.fromPrivateLink(this.privateKey,this.chaincode,...this.exportMeta())}toPrivateLink(){return this.copy()}toPublicLink(){return this.copy(!0)}async toBase58(){const{prefix:n}=this.config,e=this.isPrivate?n.private:n.public;let t=v.buff(new ArrayBuffer(9));t.write(v.num(e,4).reverse(),0),t.write(v.num(this.depth,1),4),t.write(v.num(this.refcode,4).reverse(),5),t=t.append(this.rawindex),t=t.append(this.chaincode),t=null!==this.privateKey?t.append(Uint8Array.of(0,...this.privateKey)):t.append(this.publicKey);const r=(await Tn(t)).slice(0,4);return t.append(r).toBase58()}async toWIF(){const{prefix:n}=this.config,e=function(n){if(null==n||n.every((n=>0===n)))throw new TypeError("Data buffer cannot be empty!");return n}(this.privateKey),t=v.buff(new ArrayBuffer(34));t.write(v.num(n.export),0),t.write(e,1),t.write(v.num(1),33);const r=(await Tn(t)).slice(0,4);return t.append(r).toBase58()}async derive(n,e=!1,t){!function(n,e){if(n&&!e)throw new TypeError("Private key is required.")}(e,this.isPrivate);const{name:r}=this.config,i=await this.getRef(),o=e&&null!==this.privateKey?Uint8Array.of(0,...this.privateKey,...n):Uint8Array.of(...this.publicKey,...n),[s,a]=await Mn(this.chaincode,o);if(null!==this.privateKey){const e=function(n,e){k(n),z(e);try{return Q.set(n),j.set(e),1===N.privateAdd()?Q.slice(0,32):null}finally{Q.fill(0),j.fill(0)}}(this.privateKey,s);return null===e?this.derive(zn(o)):_n.fromPrivateLink(e,a,r,n,this.depth+1,i,t)}{const e=function(n,e,t){K(n),z(e);const r=O(t,n);try{return W.set(n),j.set(e),1===N.pointAddScalar(n.length,r)?W.slice(0,r):null}finally{W.fill(0),j.fill(0)}}(this.publicKey,s,!0);return null===e?this.derive(zn(o)):_n.fromPublicLink(e,a,r,n,this.depth+1,i,t)}}async getSoftIndex(n){const e=v.num(n,4);return this.derive(e.reverse(),!1)}async getHardIndex(n){const{index:e}=this.config,t=n+e.signMask,r=v.num(t,4);return this.derive(r.reverse(),!0)}async getSoftMap(n,e=0){const{map:t}=this.config,r=Uint8Array.of(t.softPrefix,e,...n);return this.derive(r,!1)}async getHardMap(n,e=0){const{map:t}=this.config,r=Uint8Array.of(t.hardPrefix,e,...n);return this.derive(r,!0)}async getKeyIndex(n,e){const t=v.num(e,4),r=await Sn(Ln.encode(n),t.reverse());return this.derive(r,!0)}async getKeyMap(n,e,t=0){const{map:r}=this.config,i=await Sn(Ln.encode(n),e),o=Uint8Array.of(r.softPrefix,t,...i);return this.derive(o,!0)}async getPath(n){const{defaults:e}=this.config;!function(n){n.match(/^(m\/)?((\w+:)?\w+'?#?\/)*(\w+:)?\w+'?#?$/)}(n);let t=n.split("/");"m"===t[0]&&(sn(this.refcode,e.refcode),t=t.slice(1));let r,i=this.copy();for(r of t){let n,e=!1,t=!1;if(r.includes(":")){const[t,i]=r.split(":");e=!0,n=t,r=i}if("#"===r.slice(0)&&(t=!0,r=r.slice(1)),"'"===r.slice(-1)&&(e=!0,r=r.slice(0,-1)),null===r.match(/^[0-9]{1,10}$/)||t){const o=t?1:0,s=t&&null!==r.match(/^[0-9a-fA-F]$/)?v.hex(r):Ln.encode(r);i=e?"string"===n?await i.getKeyMap(n,s,o):await i.getHardMap(s,o):await i.getSoftMap(s,o)}else{const t=parseInt(r,10);i=e?"string"===n?await i.getKeyIndex(n,t):await i.getHardIndex(t):await i.getSoftIndex(t)}}return i}static fromBase58(n,e=_n.DEFAULT_TYPE){const t=cn(e),r=new m(v.base58(n)),i=r.read(4).toNum();!function(n,e){const{private:t,public:r}=e;if(n!==t&&n!==r)throw new TypeError("Key version number does not match configuration.")}(i,t.prefix);const o=r.read(1).toNum(),s=r.read(4).toNum();0===o&&sn(s,t.defaults.refcode);const a=r.read(4);!function(n,e){if(0===n&&0!==e)throw new TypeError("Starting index must be zero at depth zero.")}(o,a.toNum());const c=r.read(32),u=r.read(33);return i===t.prefix.private?(function(n){if(0!==n)throw new TypeError("Private key must start with zero byte.")}(u[0]),_n.fromPrivateLink(u,c,e,a,o,s)):(function(n){if(2!==n&&3!==n)throw new TypeError("Public key must start with a valid byte.")}(u[0]),_n.fromPublicLink(u,c,e,a,o,s))}static fromPrivateLink(n,e,...t){return function(n){if(!en(n))throw new TypeError("Private key invalid. Not within range of N!")}(n),new _n(n,null,e,...t)}static fromPublicLink(n,e,...t){return function(n){if(!nn(n))throw new TypeError("Public key invalid. Point is not on the curve!")}(n),new _n(null,n,e,...t)}static async fromSeed(n,e=_n.DEFAULT_TYPE){!function(n){if(n<16||n>64)throw new TypeError("Seed length should be between 128 bits and 512 bits.")}(n.length);const t=cn(e),r=await kn(Ln.encode(t.seed),n),i=r.slice(0,32),o=r.slice(32);return _n.fromPrivateLink(i,o,e)}}_n.DEFAULT_TYPE="bitcoin",n("Test Suite",(n=>{n.test("Vectors tests",(async n=>{await async function(n){for(let e=1;e<5;e++){const t=await import(`./vectors/vector-0${e}.json`),{title:r,seed:i,vectors:o}=t.default;n.test(r,(async n=>{const t=await _n.fromSeed(v.hex(i));for(let r=0;r<o.length;r++){const[i,s,a]=o[r];n.test(`Vector ${e}.${r+1}`,(async n=>{const o=await t.getPath(i),c=o.toPublicLink();n.plan(2),n.equal(await o.toBase58(),s,`Test vector ${e}.${r+1}: xprv`),n.equal(await c.toBase58(),a,`Test vector ${e}.${r+1}: xpub`)}))}}))}}(n)})),n.test("Import tests",(async n=>{await async function(n){const e=await Promise.resolve().then((function(){return qn})),{title:t,seed:r,vectors:i}=e.default;n.plan(16);for(const[e,t]of i)n.throws((()=>{_n.fromBase58(e)}),/TypeError/,t)}(n)}))}));var Bn="These vectors test that invalid extended keys are recognized as invalid.",Nn=[["xpub661MyMwAqRbcEYS8w7XLSVeEsBXy79zSzH1J8vCdxAZningWLdN3zgtU6LBpB85b3D2yc8sfvZU521AAwdZafEz7mnzBBsz4wKY5fTtTQBm","pubkey version / prvkey mismatch"],["xprv9s21ZrQH143K24Mfq5zL5MhWK9hUhhGbd45hLXo2Pq2oqzMMo63oStZzFGTQQD3dC4H2D5GBj7vWvSQaaBv5cxi9gafk7NF3pnBju6dwKvH","prvkey version / pubkey mismatch"],["xpub661MyMwAqRbcEYS8w7XLSVeEsBXy79zSzH1J8vCdxAZningWLdN3zgtU6Txnt3siSujt9RCVYsx4qHZGc62TG4McvMGcAUjeuwZdduYEvFn","invalid pubkey prefix 04"],["xprv9s21ZrQH143K24Mfq5zL5MhWK9hUhhGbd45hLXo2Pq2oqzMMo63oStZzFGpWnsj83BHtEy5Zt8CcDr1UiRXuWCmTQLxEK9vbz5gPstX92JQ","invalid prvkey prefix 04"],["xpub661MyMwAqRbcEYS8w7XLSVeEsBXy79zSzH1J8vCdxAZningWLdN3zgtU6N8ZMMXctdiCjxTNq964yKkwrkBJJwpzZS4HS2fxvyYUA4q2Xe4","invalid pubkey prefix 01"],["xprv9s21ZrQH143K24Mfq5zL5MhWK9hUhhGbd45hLXo2Pq2oqzMMo63oStZzFAzHGBP2UuGCqWLTAPLcMtD9y5gkZ6Eq3Rjuahrv17fEQ3Qen6J","invalid prvkey prefix 01"],["xprv9s2SPatNQ9Vc6GTbVMFPFo7jsaZySyzk7L8n2uqKXJen3KUmvQNTuLh3fhZMBoG3G4ZW1N2kZuHEPY53qmbZzCHshoQnNf4GvELZfqTUrcv","zero depth with non-zero parent refcode"],["xpub661no6RGEX3uJkY4bNnPcw4URcQTrSibUZ4NqJEw5eBkv7ovTwgiT91XX27VbEXGENhYRCf7hyEbWrR3FewATdCEebj6znwMfQkhRYHRLpJ","zero depth with non-zero parent refcode"],["xprv9s21ZrQH4r4TsiLvyLXqM9P7k1K3EYhA1kkD6xuquB5i39AU8KF42acDyL3qsDbU9NmZn6MsGSUYZEsuoePmjzsB3eFKSUEh3Gu1N3cqVUN","zero depth with non-zero index"],["xpub661MyMwAuDcm6CRQ5N4qiHKrJ39Xe1R1NyfouMKTTWcguwVcfrZJaNvhpebzGerh7gucBvzEQWRugZDuDXjNDRmXzSZe4c7mnTK97pTvGS8","zero depth with non-zero index"],["DMwo58pR1QLEFihHiXPVykYB6fJmsTeHvyTp7hRThAtCX8CvYzgPcn8XnmdfHGMQzT7ayAmfo4z3gY5KfbrZWZ6St24UVf2Qgo6oujFktLHdHY4","unknown extended key version"],["DMwo58pR1QLEFihHiXPVykYB6fJmsTeHvyTp7hRThAtCX8CvYzgPcn8XnmdfHPmHJiEDXkTiJTVV9rHEBUem2mwVbbNfvT2MTcAqj3nesx8uBf9","unknown extended key version"],["xprv9s21ZrQH143K24Mfq5zL5MhWK9hUhhGbd45hLXo2Pq2oqzMMo63oStZzF93Y5wvzdUayhgkkFoicQZcP3y52uPPxFnfoLZB21Teqt1VvEHx","private key 0 not in 1..n-1"],["xprv9s21ZrQH143K24Mfq5zL5MhWK9hUhhGbd45hLXo2Pq2oqzMMo63oStZzFAzHGBP2UuGCqWLTAPLcMtD5SDKr24z3aiUvKr9bJpdrcLg1y3G","private key n not in 1..n-1"],["xpub661MyMwAqRbcEYS8w7XLSVeEsBXy79zSzH1J8vCdxAZningWLdN3zgtU6Q5JXayek4PRsn35jii4veMimro1xefsM58PgBMrvdYre8QyULY","invalid pubkey 020000000000000000000000000000000000000000000000000000000000000007"],["xprv9s21ZrQH143K3QTDL4LXw2F7HEK3wJUD2nW2nRk4stbPy6cq3jPPqjiChkVvvNKmPGJxWUtg6LnF5kejMRNNU3TGtRBeJgk33yuGBxrMPHL","invalid checksum"]],Hn={title:Bn,seed:null,vectors:Nn},qn=Object.freeze({__proto__:null,title:Bn,seed:null,vectors:Nn,default:Hn})}(tape,crypto);
